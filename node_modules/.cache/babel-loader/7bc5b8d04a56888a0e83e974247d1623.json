{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dannblack/Desktop/Ironhack/semana8-9-fullstack/deadstarhevean/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/dannblack/Desktop/Ironhack/semana8-9-fullstack/deadstarhevean/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/dannblack/Desktop/Ironhack/semana8-9-fullstack/deadstarhevean/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthContext from'./AuthContext';import AuthReducer from'./AuthReducer';import service from'../../config/axios';import tokenAuth from'../../config/token';import{useParams}from'react-router-dom';import{REGISTRO_EXITOSO,REGISTRO_ERROR,OBTENER_USUARIO,LOGIN_EXITOSO,LOGIN_ERROR,CERRAR_SESION,AGREGAR_CARRITO,EDITAR_USUARIO,ELIMINAR_USUARIO}from'../../types';import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){// DATOS INICIALES CON LOS CUALES EMPEZAMOS EL ESTADO GLOBAL\nvar initialState={token:localStorage.getItem('token'),autenticado:null,usuario:null,// información del usuario\nmensaje:null,// relacionado con las alertas\ncargando:true};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Registra un usuario\nvar registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"estoy en registrar usuarios\");console.log(datos);_context.prev=2;_context.next=5;return service.post('/user',datos);case 5:respuesta=_context.sent;dispatch({type:REGISTRO_EXITOSO,payload:respuesta.data});// OBTENER EL USUARIO\nusuarioAutenticado();_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);// console.log(error.response.data.msg)\nalerta={msg:_context.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:REGISTRO_ERROR,payload:alerta});case 14:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();// Retorna el usuario autenticado\nvar usuarioAutenticado=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=localStorage.getItem('token');// LEER EL TOKEN DE LOCAL STORAGE\nif(token){// Función para enviar el token por headers\ntokenAuth(token);}_context2.prev=2;_context2.next=5;return service.get('/auth');case 5:respuesta=_context2.sent;dispatch({type:OBTENER_USUARIO,payload:respuesta.data.user});_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);dispatch({type:LOGIN_ERROR});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function usuarioAutenticado(){return _ref2.apply(this,arguments);};}();// Cuando el usuario inicia sesión\nvar iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return service.post('/auth',datos);case 3:respuesta=_context3.sent;dispatch({type:LOGIN_EXITOSO,payload:respuesta.data});usuarioAutenticado();_context3.next=13;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);alerta={msg:_context3.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:LOGIN_ERROR,payload:alerta});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();// Cierra la sesión del usuario\nvar cerrarSesion=function cerrarSesion(){dispatch({type:CERRAR_SESION});};var agregarCarrito=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(producto){var result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return service.patch(\"/user/profile/edit\",producto);case 2:result=_context4.sent;dispatch({type:AGREGAR_CARRITO,payload:result.data.profile});case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function agregarCarrito(_x3){return _ref4.apply(this,arguments);};}();var editarUsuario=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(datos,id){var respuesta;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return service.put(\"/user/profile/change/\".concat(id),datos);case 2:respuesta=_context5.sent;dispatch({type:EDITAR_USUARIO,payload:respuesta.data.profile});case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function editarUsuario(_x4,_x5){return _ref5.apply(this,arguments);};}();var eliminarUsuario=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(info){var result;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return service.delete(\"/user/profile/delete\",info);case 2:result=_context6.sent;dispatch({type:ELIMINAR_USUARIO,payload:result.info});case 4:case\"end\":return _context6.stop();}}},_callee6);}));return function eliminarUsuario(_x6){return _ref6.apply(this,arguments);};}();return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,cargando:state.cargando,registrarUsuario:registrarUsuario,iniciarSesion:iniciarSesion,usuarioAutenticado:usuarioAutenticado,cerrarSesion:cerrarSesion,agregarCarrito:agregarCarrito,editarUsuario:editarUsuario,eliminarUsuario:eliminarUsuario},children:props.children});};export default AuthState;","map":{"version":3,"sources":["/Users/dannblack/Desktop/Ironhack/semana8-9-fullstack/deadstarhevean/frontend/src/context/autenticacion/AuthState.js"],"names":["React","useReducer","AuthContext","AuthReducer","service","tokenAuth","useParams","REGISTRO_EXITOSO","REGISTRO_ERROR","OBTENER_USUARIO","LOGIN_EXITOSO","LOGIN_ERROR","CERRAR_SESION","AGREGAR_CARRITO","EDITAR_USUARIO","ELIMINAR_USUARIO","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","registrarUsuario","datos","console","log","post","respuesta","type","payload","data","usuarioAutenticado","alerta","msg","response","categoria","get","user","iniciarSesion","cerrarSesion","agregarCarrito","producto","patch","result","profile","editarUsuario","id","put","eliminarUsuario","info","delete","children"],"mappings":"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","sourcesContent":["import React, {useReducer} from 'react'\nimport AuthContext from './AuthContext'\nimport AuthReducer from './AuthReducer'\n\nimport service from '../../config/axios'\nimport tokenAuth from '../../config/token'\n\nimport { useParams } from 'react-router-dom'\n\nimport {\n    REGISTRO_EXITOSO,\n    REGISTRO_ERROR,\n    OBTENER_USUARIO,\n    LOGIN_EXITOSO,\n    LOGIN_ERROR,\n    CERRAR_SESION,\n    AGREGAR_CARRITO,\n    EDITAR_USUARIO,\n    ELIMINAR_USUARIO\n} from '../../types'\n\n\nconst AuthState = props => {\n\n    // DATOS INICIALES CON LOS CUALES EMPEZAMOS EL ESTADO GLOBAL\n    const initialState = {\n        token: localStorage.getItem('token'), \n        autenticado: null,\n        usuario: null, // información del usuario\n        mensaje: null,  // relacionado con las alertas\n        cargando: true,\n    }\n\n    const [state, dispatch] = useReducer(AuthReducer, initialState)\n    \n    // Registra un usuario\n    const registrarUsuario = async datos => {\n        console.log(\"estoy en registrar usuarios\")\n        console.log(datos)\n        try{\n            const respuesta = await service.post('/user', datos)\n\n            dispatch({\n                type: REGISTRO_EXITOSO,\n                payload: respuesta.data\n            })\n\n            // OBTENER EL USUARIO\n            usuarioAutenticado()\n\n        } catch(error){\n            // console.log(error.response.data.msg)\n            const alerta = {\n                msg: error.response.data.msg,\n                categoria: \"alerta-error\"\n            }\n            dispatch({\n                type: REGISTRO_ERROR,\n                payload: alerta\n            })\n        }\n    }\n\n    // Retorna el usuario autenticado\n    const usuarioAutenticado = async () => {\n        const token = localStorage.getItem('token') // LEER EL TOKEN DE LOCAL STORAGE\n\n        if(token) {\n            // Función para enviar el token por headers\n            tokenAuth(token)\n        }\n\n        try {\n            const respuesta = await service.get('/auth')\n\n            dispatch({\n                type: OBTENER_USUARIO,\n                payload: respuesta.data.user\n            })\n\n\n        } catch(error) {\n            dispatch({\n                type: LOGIN_ERROR\n            })\n        }\n\n    }   \n\n    // Cuando el usuario inicia sesión\n    const iniciarSesion = async datos => {\n        try{\n            const respuesta = await service.post('/auth', datos)\n            \n            dispatch({\n                type: LOGIN_EXITOSO,\n                payload: respuesta.data\n            })\n\n            usuarioAutenticado()\n\n        } catch(error){\n            console.log(error)\n            const alerta = {\n                msg: error.response.data.msg,\n                categoria: \"alerta-error\"\n            }\n            dispatch({\n                type: LOGIN_ERROR,\n                payload: alerta\n            })\n        }\n    }\n\n    // Cierra la sesión del usuario\n    const cerrarSesion = () => {\n        dispatch({\n            type: CERRAR_SESION\n        })\n    }\n\n    const agregarCarrito = async (producto) => {\n        const result = await service.patch(\"/user/profile/edit\", producto)\n        dispatch({\n            type: AGREGAR_CARRITO,\n            payload: result.data.profile\n        })\n    }\n\n\n    const editarUsuario = async (datos, id) => {\n        const respuesta = await service.put(`/user/profile/change/${id}`, datos)\n        dispatch({\n            type: EDITAR_USUARIO,\n            payload: respuesta.data.profile\n        })\n    }\n\n\n    const eliminarUsuario = async(info) => {\n        const result = await service.delete(\"/user/profile/delete\", info)\n        dispatch({\n            type: ELIMINAR_USUARIO,\n            payload: result.info\n        })\n    }\n\n    return (\n        <AuthContext.Provider value={{\n            token: state.token,\n            autenticado: state.autenticado,\n            usuario: state.usuario,\n            mensaje: state.mensaje,\n            cargando: state.cargando,\n            registrarUsuario,\n            iniciarSesion,\n            usuarioAutenticado,\n            cerrarSesion,\n            agregarCarrito,\n            editarUsuario,\n            eliminarUsuario\n        }}>\n            {props.children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthState"]},"metadata":{},"sourceType":"module"}